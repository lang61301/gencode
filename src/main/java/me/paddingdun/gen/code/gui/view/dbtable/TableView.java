/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package me.paddingdun.gen.code.gui.view.dbtable;

import java.awt.EventQueue;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.util.Vector;
import java.util.concurrent.Callable;

import javax.swing.table.DefaultTableModel;
import javax.swing.tree.DefaultTreeModel;

import me.paddingdun.gen.code.data.message.Message;
import me.paddingdun.gen.code.data.tabletree.Table;
import me.paddingdun.gen.code.db.TableHelper;
import me.paddingdun.gen.code.gui.perspective.designer.DesignerPerspective;
import me.paddingdun.gen.code.gui.view.AbstractView;
import me.paddingdun.gen.code.util.TaskHelper;

/**
 *
 * @author admin
 */
public class TableView extends AbstractView {

	private DesignerPerspective perspective;
	
    /**
     * Creates new form TableFrame
     */
    public TableView(DesignerPerspective perspective) {
    	super();
    	this.perspective = perspective;
        initComponents();
        
        init();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

    	setIconifiable(true);
        setMaximizable(true);
        setResizable(true);
        setTitle("数据库表详细内容");
        sp = new javax.swing.JScrollPane();
        table = new javax.swing.JTable();

        sp.setViewportView(table);
        
        this.addComponentListener(new java.awt.event.ComponentAdapter() {
            public void componentShown(java.awt.event.ComponentEvent evt) {
                afterShow(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(sp, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(sp, javax.swing.GroupLayout.DEFAULT_SIZE, 278, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents
    
    private void afterShow(java.awt.event.ComponentEvent evt) {//GEN-FIRST:event_afterShow
    	table.addMouseListener(new MouseAdapter() {
    	    @Override
    	    public void mouseClicked(MouseEvent e){
    	    	System.out.println(table.getSelectedRow());
    	    }
    	});
    }


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JScrollPane sp;
    private javax.swing.JTable table;
    // End of variables declaration//GEN-END:variables

	/* (non-Javadoc)
	 * @see me.paddingdun.gen.code.gui.view.AbstractView#doMessage(me.paddingdun.gen.code.data.message.Message)
	 */
	@Override
	public void doMessage(Message message) {
		//表格树点击消息;
		if(DesignerPerspective.MESSAGE_CLICK_TABLE_TREE_NODE.equals(message.getName())){
			final Table t = (Table)message.getObject();
			
			TaskHelper.runInNonEDT(new Callable<Integer[]>() {
				public Integer[] call() throws Exception {
					
					Vector<Vector<Object>> v = TableHelper.tableRecord(t.getCat(), t.getTableName());
					Vector<Object> v2 = new Vector<Object>();
//								DefaultTableColumnModel dtcm = new DefaultTableColumnModel();
			    	String[] heads = new String[]{"列名称", "列类型", "列描述"};
//			    	v2.add("select");
			    	for (int i = 0; i < heads.length; i++) {
//						    		TableColumn h = new TableColumn(i);
//						        	h.setHeaderValue(heads[i]);
//						        	dtcm.addColumn(h);
			        	v2.add(heads[i]);
					}
//						    	table.setColumnModel(dtcm);
					final DefaultTableModel dtm = new DefaultTableModel(v, v2)/**{
						private static final long serialVersionUID = 1L;

						public Class<?> getColumnClass(int col){
							Object value = getValueAt(0, col);
					        if(value!=null)
					            return value.getClass();
					        else 
					        	return super.getClass();
						}
					}**/;
					
					EventQueue.invokeLater(new Runnable() {
						public void run() {
							table.setModel(dtm);
					    	table.updateUI();
						}
					});
					return new Integer[]{0};
				}
			});
		}
	}
}
